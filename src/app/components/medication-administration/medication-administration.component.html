<!--BEGIN LICENSE BLOCK--> 
<!--Interneuron Terminus

Copyright(C) 2022  Interneuron CIC

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.If not, see<http://www.gnu.org/licenses/>. -->
<!--END LICENSE BLOCK--> 
<div
    *ngIf="editpopuptypetype !='Undo Administration' && !currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause') && !currentDose.dose_id.includes('end')">
    <!-- <div *ngIf="showEndInfusion && !showTitration" >
    <app-end-infusion [dose]="dose" [prescription]="prescription"  [administration]="administration" (hideEndInfusionForm)="hideEndInfusionForm()"></app-end-infusion>
</div> -->

    <div *ngIf="editpopuptypetype=='Administration' || editpopuptypetype=='OpAdministration'  || editpopuptypetype=='Edit Administration'"
        class="modal fade bd-example-modal-lg" [config]="{backdrop: 'static',show: true,  keyboard: false}" bsModal
        tabindex="-1" data-keyboard="false" data-backdrop="static" style="display: block;" role="dialog"
        aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg  modal-dialog-centered" role="document">
            <div class="modal-content">
                <h3 class="popover-title popover-header">
                    {{headerLabel}} - {{plannedDate}}
                    <div *ngIf="!showSpinner" class="close close-adminstration" (click)="closePopup()"></div>
                </h3>

                <div class="modal-body" #administrationform id="adminform">

                    <div class="row">
                        <div class="col-11" style="padding: 0;">
                            <app-prescription-template [posologyid]="this.dose.posology_id"
                                (showTitrationForm)="showTitrationForm()" [prescription]="prescription"
                                [administration]="administration" componenttype="administer">
                            </app-prescription-template>
                        </div>
                        <div class="col" style="padding: 0;">
                            <span style="display: block;margin-top: 0.1rem;cursor: pointer;"
                                (click)="showAdministrationWarning()"
                                [ngClass]="{'medication-property-icon High_alert_medication': hasAdministrationWarning===true}"></span>
                        </div>
                    </div>

                    <div class="row" *ngIf="!dose.prn">
                        <div class="col-12 mt-1 mb-1">
                            <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary"
                                    [ngClass]="{'active':administration.adminstrationstatus == 'given'}"
                                    (click)="adminStatus('given')">Given</button>
                                <!-- <button *ngIf="!currentDose.isinfusion || (currentDose.isinfusion && editpopuptypetype != 'Edit Administration')"  type="button" class="btn btn-sm btn-outline-primary" [ngClass]="{'active':administration.adminstrationstatus == 'defer'}" (click)="adminStatus('defer')">Defer</button> -->
                                <button type="button" class="btn btn-sm btn-outline-primary"
                                 *ngIf="editpopuptypetype!='OpAdministration'"   [ngClass]="{'active':administration.adminstrationstatus == 'self-administer'}"
                                    (click)="adminStatus('self-administer')">Self admin</button>
                                <button type="button" class="btn btn-sm btn-outline-primary"
                                *ngIf="editpopuptypetype!='OpAdministration'"     [ngClass]="{'active':administration.adminstrationstatus == 'notgiven'}"
                                    (click)="adminStatus('notgiven')">Not given</button>
                            </div>
                        </div>

                    </div>
                    <div class="row" *ngIf="dose.prn">
                        <div class="col-12 mt-1 mb-1">
                            <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;" role="group">
                                <button type="button" class="btn btn-sm btn-outline-primary"
                                    [ngClass]="{'active':administration.adminstrationstatus == 'given'}"
                                    (click)="adminStatus('given')">Given</button>
                                <button type="button" class="btn btn-sm btn-outline-primary"
                                *ngIf="editpopuptypetype!='OpAdministration'"    [ngClass]="{'active':administration.adminstrationstatus == 'self-administer'}"
                                    (click)="adminStatus('self-administer')">Self admin</button>
                            </div>
                        </div>

                    </div>
                    <div class="card" *ngIf="administration.adminstrationstatus=='given'">
                        <div class="card-body">
                            <div class="row border-bottom  pb-1">
                                <div class="col-4">
                                    PRODUCT
                                </div>
                                <div class="col-8">
                                    <ng-container *ngTemplateOutlet="productdropdowntemp"></ng-container>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-4">
                                    BATCH NUMBER
                                </div>
                                <div class="col-8">
                                    <span class="float-right">
                                        <input [(ngModel)]="administration.batchnumber" type="text" maxlength="15"
                                            class="epma-adminstration-form-control" />
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-4">
                                    EXPIRY DATE
                                </div>
                                <div class="col-8">
                                    <span class="float-right">
                                        <input [minDate]="currDate" onkeydown="event.preventDefault()" type="text"
                                            [(ngModel)]="expirydate" class="epma-adminstration-form-control"
                                            style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }" />
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1"
                                *ngIf="!currentposology.infusiontypeid || currentposology.infusiontypeid=='bolus'">
                                <div class="col-3">
                                    DOSE
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <span *ngIf="currentposology.dosetype=='units'">
                                            <span class="empa-bold" *ngIf="currentposology.__dose.length>0"><input
                                                    (input)="setMaxDoseWarning()" type="number" min="0"
                                                    positiveNumbersOnly class="epma-adminstration-form-control"
                                                    style="width:80px" [(ngModel)]="administration.administreddosesize"
                                                    value="administration.administreddosesize">
                                                <strong>{{administration.administreddoseunit}}</strong></span>
                                        </span>
                                        <span *ngIf="currentposology.dosetype=='strength'">
                                            <span class="empa-bold" *ngIf="currentposology.__dose.length>0">
                                                <input (input)="setMaxDoseWarning()" positiveNumbersOnly min="0"
                                                    type="number" class="epma-adminstration-form-control"
                                                    style="width:80px" (change)="volumeFordose()"
                                                    [(ngModel)]="administration.administeredstrengthneumerator"
                                                    value="administration.administeredstrengthneumerator">
                                                <strong>{{administration.administeredstrengthneumeratorunits}} </strong>
                                                / <input positiveNumbersOnly min="0" type="number"
                                                    class="epma-adminstration-form-control" style="width:80px"
                                                    (change)="doseForVolume()"
                                                    [(ngModel)]="administration.administeredstrengthdenominator"
                                                    value="administration.administeredstrengthdenominator">
                                                <strong>{{administration.administeredstrengthdenominatorunits}}
                                                </strong>
                                            </span>
                                        </span>
                                        <span *ngIf="currentposology.dosetype=='descriptive'">
                                            <span
                                                class="empa-bold">{{administration.administereddescriptivedose}}</span>
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1"
                                *ngIf="currentposology.infusiontypeid=='ci' || currentposology.infusiontypeid=='rate'">
                                <div class="col-3">
                                    RATE
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <input positiveNumbersOnly min="0" type="number"
                                            class="epma-adminstration-form-control" style="width:80px"
                                            [(ngModel)]="administration.administredinfusionrate"
                                            value="administration.administredinfusionrate">
                                        <span>{{currentposology.infusionrateunits}}</span>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1" *ngIf="prescription.__routes.length>1">
                                <div class="col-3">
                                    ROUTE OF ADMINISTRATION
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;"
                                            role="group">
                                            <button *ngFor="let r of prescription.__routes" type="button"
                                                class="btn btn-sm btn-outline-primary"
                                                [ngClass]="{'active':r.prescriptionroutes_id == administration.prescriptionroutesid}"
                                                (click)="setAdministredRoute(r)">{{r.route}}</button>

                                        </div>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1" *ngIf="doctorcomments">
                                <div class="col-5">
                                    PRESCRIBER's COMMENTS
                                </div>
                                <div class="col-7">
                                    <span class="float-right text-break">
                                        {{doctorcomments}}
                                    </span>
                                </div>
                            </div>

                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-7">
                                    ADMINISTRATION TIME
                                </div>
                                <div class="col-5">

                                    <span class="float-right" style="display: flex;">
                                        <input onkeydown="event.preventDefault()" type="text" [minDate]="minDate"
                                            [maxDate]="maxDate" [(ngModel)]="stardate" placeholder="Start Date"
                                            class="epma-adminstration-form-control" style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }"
                                            (bsValueChange)="setMaxDoseWarning()" />
                                        <input type="text" name="startime" [(ngModel)]="startime" style="width:80px;"
                                            class="epma-adminstration-form-control" placeholder="HH:mm"
                                            [appTimepicker]="timepicker1">
                                        <app-time-picker #timepicker1 (onTimeSelected)="onTimeSelected($event)">
                                        </app-time-picker>
                                    </span>
                                </div>
                            </div>

                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-4">
                                    <span [ngClass]="iswitnessRequired ? 'required-field': ''">WITNESS</span>
                                </div>
                                <div class="col-8">

                                    <span class="float-right">
                                        <span class="mr-2">{{witnessDisplayName}}</span>
                                        <input type="button" (click)="openWitnessAuthnication()"
                                            class="btn btn-sm btn-outline-primary" [value]="witnessBtnValue" /></span>
                                </div>
                            </div>

                            <div *ngIf="editpopuptypetype!='OpAdministration' && appService.AuthoriseAction('epma_create_supplyrequest_fromadministration') && appService.bannerWarningStatus  && appService.warningServiceIPContext.existingWarningsStatus"
                                class="row border-bottom pb-1 pt-1">
                                <div class="col-5">
                                    PLEASE RESUPPLY
                                </div>
                                <div class="col-7">
                                    <span class="float-right"><input type="checkbox" id="resupply"
                                            [(ngModel)]="administration.requestresupply"
                                            (change)="onResupply($event,confirmWardStockTemplate)" /> <label
                                            for="resupply" class="ml-1">Yes</label></span>
                                </div>
                            </div>

                            <div class="row pb-1 pt-1">
                                <div class="col-12">
                                    COMMENTS
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-12">
                                    <textarea maxlength="1024" class="form-control"
                                        [(ngModel)]="administration.comments" rows="2"></textarea>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="card" *ngIf="administration.adminstrationstatus=='defer'">
                        <div class="card-body">


                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-6">
                                    ADMINISTRATION TIME
                                </div>
                                <div class="col-6">

                                    <span class="float-right" style="display: flex;">
                                        <input onkeydown="event.preventDefault()" type="text" [maxDate]="maxDate"
                                            [(ngModel)]="stardate" placeholder="Start Date"
                                            class="epma-adminstration-form-control" style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }" />
                                        <input type="text" name="startime" [(ngModel)]="startime" style="width:80px;"
                                            class="epma-adminstration-form-control" placeholder="HH:mm"
                                            [appTimepicker]="timepicker1">
                                        <app-time-picker #timepicker1 (onTimeSelected)="onTimeSelected($event)">
                                        </app-time-picker>
                                    </span>
                                </div>
                            </div>


                            <div *ngIf="appService.AuthoriseAction('epma_create_supplyrequest_fromadministration') && appService.bannerWarningStatus && appService.warningServiceIPContext.existingWarningsStatus"
                                class="row border-bottom pb-1 pt-1">
                                <div class="col-3">
                                    PLEASE RESUPPLY
                                </div>
                                <div class="col-9">
                                    <span class="float-right"><input type="checkbox" id="resupply"
                                            [(ngModel)]="administration.requestresupply"
                                            (change)="onResupply($event,confirmWardStockTemplate)" /> <label
                                            for="resupply" class="ml-1">Yes</label></span>
                                </div>
                            </div>

                            <div class="row pb-1 pt-1">
                                <div class="col-12">
                                    COMMENTS
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-12">
                                    <textarea maxlength="1024" class="form-control"
                                        [(ngModel)]="administration.comments" rows="2"></textarea>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="card" *ngIf="administration.adminstrationstatus=='self-administer'">
                        <div class="card-body">
                            <div class="row border-bottom  pb-1">
                                <div class="col-lg-8 col-md-10 col-sm-12 mt-1 mb-1">
                                    <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;"
                                        role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.levelofselfadmin==levelOfSelfAdmin.notwitnessedbynurse}"
                                            (click)="administration.levelofselfadmin=levelOfSelfAdmin.notwitnessedbynurse">Not
                                            witnessed by nurse</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.levelofselfadmin==levelOfSelfAdmin.witnessedbynurse}"
                                            (click)="administration.levelofselfadmin=levelOfSelfAdmin.witnessedbynurse">
                                            Witnessed by nurse</button>
                                    </div>


                                </div>
                            </div>
                            <div class="row border-bottom  pb-1">
                                <div class="col-4">
                                    PRODUCT
                                </div>
                                <div class="col-8">
                                    <ng-container *ngTemplateOutlet="productdropdowntemp"></ng-container>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-4">
                                    BATCH NUMBER
                                </div>
                                <div class="col-8">
                                    <span class="float-right">
                                        <input [(ngModel)]="administration.batchnumber" maxlength="15" type="text"
                                            class="epma-adminstration-form-control" />
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-4">
                                    EXPIRY DATE
                                </div>
                                <div class="col-8">
                                    <span class="float-right">
                                        <input [minDate]="currDate" type="text" onkeydown="event.preventDefault()"
                                            [(ngModel)]="expirydate" class="epma-adminstration-form-control"
                                            style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }" />
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1"
                                *ngIf="!currentposology.infusiontypeid || currentposology.infusiontypeid=='bolus'">
                                <div class="col-3">
                                    DOSE
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <span *ngIf="currentposology.dosetype=='units'">
                                            <span class="empa-bold" *ngIf="currentposology.__dose.length>0"><input
                                                    type="number" min="0" positiveNumbersOnly
                                                    class="epma-adminstration-form-control" style="width:80px"
                                                    [(ngModel)]="administration.administreddosesize"
                                                    value="administration.administreddosesize">
                                                <strong>{{administration.administreddoseunit}}</strong></span>
                                        </span>
                                        <span *ngIf="currentposology.dosetype=='strength'">
                                            <span class="empa-bold" *ngIf="currentposology.__dose.length>0">
                                                <input positiveNumbersOnly type="number" min="0"
                                                    class="epma-adminstration-form-control" style="width:80px"
                                                    (change)="volumeFordose()"
                                                    [(ngModel)]="administration.administeredstrengthneumerator"
                                                    value="administration.administeredstrengthneumerator">
                                                <strong>{{administration.administeredstrengthneumeratorunits}} </strong>
                                                / <input positiveNumbersOnly type="number" min="0"
                                                    class="epma-adminstration-form-control" style="width:80px"
                                                    (change)="doseForVolume()"
                                                    [(ngModel)]="administration.administeredstrengthdenominator"
                                                    value="administration.administeredstrengthdenominator">
                                                <strong>{{administration.administeredstrengthdenominatorunits}}
                                                </strong>
                                            </span>
                                        </span>
                                        <span *ngIf="currentposology.dosetype=='descriptive'">
                                            <span class="empa-bold">{{currentposology.__dose[0].descriptivedose}}</span>
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1"
                                *ngIf="currentposology.infusiontypeid=='ci' || currentposology.infusiontypeid=='rate'">
                                <div class="col-3">
                                    RATE
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <input positiveNumbersOnly min="0" type="number"
                                            class="epma-adminstration-form-control" style="width:80px"
                                            [(ngModel)]="administration.administredinfusionrate"
                                            value="administration.administredinfusionrate">
                                        <span>{{currentposology.infusionrateunits}}</span>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1" *ngIf="prescription.__routes.length>1">
                                <div class="col-3">
                                    ROUTE OF ADMINISTRATION
                                </div>
                                <div class="col-9">
                                    <span class="float-right">
                                        <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;"
                                            role="group">
                                            <button *ngFor="let r of prescription.__routes" type="button"
                                                class="btn btn-sm btn-outline-primary"
                                                [ngClass]="{'active':r.prescriptionroutes_id == administration.prescriptionroutesid}"
                                                (click)="setAdministredRoute(r)">{{r.route}}</button>

                                        </div>
                                    </span>
                                </div>
                            </div>
                            <div class="row border-bottom  pb-1 pt-1" *ngIf="doctorcomments">
                                <div class="col-5">
                                    PRESCRIBER's COMMENTS
                                </div>
                                <div class="col-7">
                                    <span class="float-right text-break">
                                        {{doctorcomments}}
                                    </span>
                                </div>
                            </div>

                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-7">
                                    ADMINISTRATION TIME
                                </div>
                                <div class="col-5">

                                    <span class="float-right" style="display: flex;">
                                        <input onkeydown="event.preventDefault()" type="text" [minDate]="minDate"
                                            [maxDate]="maxDate" [(ngModel)]="stardate" placeholder="Start Date"
                                            class="epma-adminstration-form-control" style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }" />
                                        <input type="text" name="startime" [(ngModel)]="startime" style="width:80px;"
                                            class="epma-adminstration-form-control" placeholder="HH:mm"
                                            [appTimepicker]="timepicker1">
                                        <app-time-picker #timepicker1 (onTimeSelected)="onTimeSelected($event)">
                                        </app-time-picker>
                                    </span>
                                </div>
                            </div>


                            <div *ngIf="appService.AuthoriseAction('epma_create_supplyrequest_fromadministration') && appService.bannerWarningStatus && appService.warningServiceIPContext.existingWarningsStatus"
                                class="row border-bottom pb-1 pt-1">
                                <div class="col-5">
                                    PLEASE RESUPPLY
                                </div>
                                <div class="col-7">
                                    <span class="float-right"><input type="checkbox" id="resupply"
                                            [(ngModel)]="administration.requestresupply"
                                            (change)="onResupply($event,confirmWardStockTemplate)" /> <label
                                            for="resupply" class="ml-1">Yes</label></span>
                                </div>
                            </div>

                            <div class="row pb-1 pt-1">
                                <div class="col-12">
                                    COMMENTS
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-12">
                                    <textarea maxlength="1024" class="form-control"
                                        [(ngModel)]="administration.comments" rows="2"></textarea>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="card" *ngIf="administration.adminstrationstatus=='notgiven'">
                        <div class="card-body">
                            <div class="row border-bottom  pb-1">
                                <div class="col-12">
                                    <div class="btn-group btn-group-sm btn-group-justified " style="width: 100%;"
                                        role="group">

                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Patientunavailable}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Patientunavailable">
                                            Patient unavailable</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Nilbymouth}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Nilbymouth">
                                            Nil by mouth </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Patientrefused}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Patientrefused">
                                            Patient refused </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Drugunavailable}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Drugunavailable">
                                            Drug unavailable </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Clinicalreason}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Clinicalreason">
                                            Clinical reason </button>
                                        <button type="button" class="btn btn-sm btn-outline-primary"
                                            [ngClass]="{'active' : administration.adminstrationstatusreason==administrationStatusReason.Other}"
                                            (click)="administration.adminstrationstatusreason=administrationStatusReason.Other">
                                            Other </button>


                                    </div>
                                    <div class="row mt-1"
                                        *ngIf="administration.adminstrationstatusreason==administrationStatusReason.Other">
                                        <div class="col-12">
                                            <textarea maxlength="1024" placeholder="Enter other reason"
                                                class="form-control" [(ngModel)]="otherreason" rows="2"></textarea>
                                            <span class="text-danger">{{otherReasonMessage}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row border-bottom  pb-1 pt-1">
                                <div class="col-6">
                                    ADMINISTRATION TIME
                                </div>
                                <div class="col-6">

                                    <span class="float-right" style="display: flex;">
                                        <input onkeydown="event.preventDefault()" type="text" [maxDate]="maxDate"
                                            [(ngModel)]="stardate" placeholder="Start Date"
                                            class="epma-adminstration-form-control" style="width:120px" bsDatepicker
                                            [bsConfig]="{ dateInputFormat: 'DD-MM-YYYY', containerClass: 'theme-default', adaptivePosition: true,customTodayClass:'bg-light' }" />
                                        <input type="text" name="startime" [(ngModel)]="startime" style="width:80px;"
                                            class="epma-adminstration-form-control" placeholder="HH:mm"
                                            [appTimepicker]="timepicker1">
                                        <app-time-picker #timepicker1 (onTimeSelected)="onTimeSelected($event)">
                                        </app-time-picker>
                                    </span>
                                </div>
                            </div>


                            <div *ngIf="appService.AuthoriseAction('epma_create_supplyrequest_fromadministration') && appService.bannerWarningStatus && appService.warningServiceIPContext.existingWarningsStatus"
                                class="row border-bottom pb-1 pt-1">
                                <div class="col-3">
                                    PLEASE RESUPPLY
                                </div>
                                <div class="col-9">
                                    <span class="float-right"><input type="checkbox" id="resupply"
                                            [(ngModel)]="administration.requestresupply"
                                            (change)="onResupply($event,confirmWardStockTemplate)" /> <label
                                            for="resupply" class="ml-1">Yes</label></span>
                                </div>
                            </div>

                            <div class="row pb-1 pt-1">
                                <div class="col-12">
                                    COMMENTS
                                </div>
                            </div>
                            <div class="row mt-1">
                                <div class="col-12">
                                    <textarea maxlength="1024" class="form-control"
                                        [(ngModel)]="administration.comments" rows="2"></textarea>
                                </div>
                            </div>

                        </div>

                    </div>
                    <div class="row mt-1">
                        <div class="col-12" *ngIf="validatiommessage">
                            <div class="text-danger">{{validatiommessage}}</div>
                        </div>
                    </div>
                    <div class="row mt-1">
                        <div class="col-12" *ngIf="warningMessage">
                            <div class="text-danger" style="display: flex;float: right;">
                                <div class="High_alert_medication"></div> {{warningMessage}}
                            </div>
                        </div>
                    </div>
                    <ng-template #productdropdowntemp>
                        <a *ngIf="productType!='AMP'" style="white-space: normal;cursor: pointer;"
                            (click)="isDropdownshow=!isDropdownshow" class="dropdown-toggle float-right">
                            {{productName}}
                        </a>
                        <span class="float-right" *ngIf="productType=='AMP'">{{productName}} </span>
                        <div class="row productspopdown" *ngIf="isLoadingMedication">
                            <div class="col text-muted card" #loading>
                                Loading medication...
                            </div>
                        </div>
                        <div class="row productspopdown"
                            *ngIf="showloadingmessage && (isDropdownshow || isInitializing)">
                            <div class="col text-muted card" #loading>
                                Loading {{searchtype}}...
                            </div>
                        </div>
                        <div class="row productspopdown" *ngIf="shownoresultsmessage && isDropdownshow">
                            <div class="col">
                                <div class="row">
                                    <div class="col">
                                        <div class="mt-2 close close-adminstration" (click)="isDropdownshow=false">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col text-muted" #loading>
                                        No Results
                                        <div>
                                            <a *ngIf="!isFormulary" href="#" (click)="searchProducts(true)">Show Non
                                                Formulary Medications</a>
                                            <a *ngIf="isFormulary" href="#" (click)="searchProducts(false)">Show
                                                Formulary Medications</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row productspopdown" *ngIf="results && results.data.length>0 && isDropdownshow">
                            <div class="col card" #products>
                                <div class="row">
                                    <div class="col">
                                        <div class="mt-2 close close-adminstration" (click)="isDropdownshow=false">
                                        </div>
                                    </div>
                                </div>
                                <div *ngFor="let l1 of results.data" class="l1" #l1>
                                    <div class="row" *ngIf="l1.recStatusCode == null || l1.recStatusCode == '003'">
                                        <div class="col-md-1">
                                            <div *ngIf="l1.children.length!=0" style="padding: 0.5rem;">
                                                <img src="assets/images/epma/down-arrow.png"
                                                    style="width: 20px; height: 20px;"
                                                    *ngIf="expanded.indexOf(l1.code)!=-1"
                                                    (click)="expandtoggle(l1.code)">
                                                <img src="assets/images/epma/right-arrow.png"
                                                    style="width: 20px; height: 20px;"
                                                    *ngIf="expanded.indexOf(l1.code)==-1"
                                                    (click)="expandtoggle(l1.code)">
                                            </div>
                                        </div>
                                        <div class="col-md-11">
                                            <div [ngClass]="{'productname':true, 'text-muted':!l1.prescribable}">
                                                <span (click)="selectmedication(l1)">{{l1.name}}</span>
                                                <!-- <span style="font-size: .5em;" class="text-muted mt-3 float-right small">
                                        {{l1.productType}}</span> -->
                                                <!-- - <i class="text-muted">{{l1.productType}}</i> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngFor="let l2 of l1.children" class="l2" #l2>
                                        <div class="row"
                                            *ngIf="(l2.recStatusCode == null || l2.recStatusCode == '003') && expanded.indexOf(l1.code)!=-1">
                                            <div class="col-md-1">
                                                <div *ngIf="l2.children.length!=0" style="padding: 0.5rem;">
                                                    <img src="assets/images/epma/down-arrow.png"
                                                        style="width: 20px; height: 20px;"
                                                        *ngIf="expanded.indexOf(l2.code)!=-1"
                                                        (click)="expandtoggle(l2.code)">
                                                    <img src="assets/images/epma/right-arrow.png"
                                                        style="width: 20px; height: 20px;"
                                                        *ngIf="expanded.indexOf(l2.code)==-1"
                                                        (click)="expandtoggle(l2.code)">
                                                </div>
                                            </div>
                                            <div class="col-md-11">
                                                <div [ngClass]="{'productname':true, 'text-muted':!l2.prescribable}"
                                                    (click)="selectmedication(l2)">
                                                    {{l2.name}}
                                                    <!-- <span style="font-size: .5em;" class="text-muted mt-3 float-right small">
                                            {{l2.productType}}</span> -->
                                                    <!-- - <i class="text-muted">{{l2.productType}}</i> -->
                                                </div>
                                            </div>
                                        </div>
                                        <div *ngFor="let l3 of l2.children" class="l3" #l3>
                                            <div class="row"
                                                *ngIf="(l3.recStatusCode == null || l3.recStatusCode == '003') && (expanded.indexOf(l1.code)!=-1 && expanded.indexOf(l2.code)!=-1 )">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-11">
                                                    <div [ngClass]="{'productname':true, 'text-muted':!l3.prescribable}"
                                                        (click)="selectmedication(l3)">
                                                        {{l3.name}}
                                                        <!-- <span style="font-size: .5em;"
                                                class="text-muted mt-3 float-right small">
                                                {{l3.productType}}</span> -->
                                                        <!-- - <i class="text-muted">{{l3.productType}}</i> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <a *ngIf="!isFormulary" href="#" (click)="searchProducts(true)">Show Non Formulary
                                        Medications</a>
                                    <a *ngIf="isFormulary" href="#" (click)="searchProducts(false)">Show Formulary
                                        Medications</a>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </div>
                <div *ngIf="appService.warningService && !appService.warningServiceIPContext.loader && !appService.warningServiceIPContext.existingWarningsStatus"
                    class="alert alert-danger" role="alert">
                    One or more high alerts require an override.
                </div>
                <div class="modal-footer" style="padding: 0.4rem 0rem;">

                    <div class="container">

                        <div class="row">
                            <div class="col-6">
                                <!-- <span>Revert</span> -->
                            </div>
                            <div class="col-6 text-right">
                                <button
                                    *ngIf="!(appService.warningService && !appService.warningServiceIPContext.loader && !appService.warningServiceIPContext.existingWarningsStatus) 
                                    && !appService.isTitrationPopOverOpen && (appService.isCurrentEncouner || editpopuptypetype=='OpAdministration')"
                                    type="button" style="color:white" class="btn btn-sm btn-info mr-3"
                                    (click)="saveAdministrationForm()" [disabled]="showSpinner"> <span
                                        class="spinner-border spinner-border-sm" *ngIf="showSpinner" role="status"
                                        aria-hidden="true"></span> Confirm</button>
                                <button *ngIf="!appService.isTitrationPopOverOpen && !showSpinner" data-dismiss="modal"
                                    type="button" class="btn btn-sm btn-secondary"
                                    (click)="closePopup()">Cancel</button>
                            </div>

                        </div>


                    </div>
                </div>
                <!-- <button type="button" class="btn  btn-sm btn-outline-primary">Conferm</button>
                <button type="button" class="btn btn-sm btn-outline-secondary" data-dismiss="modal">Cancel</button> -->
            </div>
        </div>
    </div>
    <!-- <div *ngIf="showTitration">
    <app-titration-chart (hideTitrationForm)="hideTitrationForm()" [dose]="dose" [prescription]="prescription" [administration]="administration" componenttype="administer" [isOnlyShowChart]="isOnlyShowChart"></app-titration-chart>
</div> -->
</div>
<div *ngIf="editpopuptypetype == 'View Administration' || editpopuptypetype == 'View History'">
    <div class="modal fade bd-example-modal-lg" [config]="{backdrop: 'static',show: true,  keyboard: false}" bsModal
        tabindex="-1" data-keyboard="false" data-backdrop="static" style="display: block;" role="dialog"
        aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <h3 class="popover-title popover-header">
                    Administration
                    <div class="close close-adminstration" (click)="closePopup()"></div>
                </h3>
                <div class="modal-body">
                    <div class="row border-bottom">
                        <div class="col-12">
                            <app-prescription-template [prescription]="prescription"
                                [posologyid]="this.dose.posology_id" componenttype="viewadministration">
                            </app-prescription-template>
                        </div>
                    </div>
                    <div *ngIf="!isShowAdministrationHistory && !isShowHistory">
                        <div *ngIf="currentDose.dose_id.includes('bolus')">
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">DOSE</span>

                                </div>
                                <div class="col-6" *ngIf="currentposology.dosetype == 'units'">
                                    <span>{{administration.administreddosesize}} mls</span>
                                </div>
                                <div class="col-6" *ngIf="currentposology.dosetype == 'strength'">
                                    <span>{{administration.administeredstrengthneumerator}}
                                        {{administration.administeredstrengthneumeratorunits}}</span>
                                    <span>/ {{administration.administeredstrengthdenominator}}
                                        {{administration.administeredstrengthdenominatorunits}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.routename">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.routename}}</div>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.batchnumber">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.batchnumber}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.expirydate">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.expirydate | date:'dd-MM-yyyy'}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.comments}}</div>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="currentDose.dose_id.includes('addadjust')">
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">RATE</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administration.administredinfusionrate}}
                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.routename">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.routename}}</div>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.batchnumber">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.batchnumber}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.expirydate">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.expirydate | date:'dd-MM-yyyy'}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.comments}}</div>
                                </div>
                            </div>

                        </div>
                        <div
                            *ngIf="currentDose.dose_id.includes('changeinfusionset') || currentDose.dose_id.includes('changeinfusionkit')">
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">Change Set/Bag </span>

                                </div>
                                <div class="col-6">
                                    <span *ngIf="infusionEvents.eventtype=='changeinfusionkit'">Change infusion
                                        kit</span>
                                    <span *ngIf="infusionEvents.eventtype=='changeinfusionset'">Change infusion</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.routename">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.routename}}</div>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.batchnumber">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.batchnumber}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.expirydate">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.expirydate | date:'dd-MM-yyyy'}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.comments}}</span>
                                </div>
                            </div>

                        </div>
                        <div *ngIf="currentDose.dose_id.includes('pause')">
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>
                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.routename">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.routename}}</div>
                                </div>
                            </div>

                            <div class="row" *ngIf="infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.comments}}</span>
                                </div>
                            </div>

                        </div>
                        <div *ngIf="currentDose.dose_id.includes('restart')">
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">RATE</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administration.administredinfusionrate}}
                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.routename">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.routename}}</div>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.batchnumber">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.batchnumber}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.expirydate">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.expirydate | date:'dd-MM-yyyy'}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.comments}}</div>
                                </div>
                            </div>

                        </div>
                        <div
                            *ngIf="!currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause')">
                            <div class="row" *ngIf="!currentDose.dose_id.includes('end')">
                                <div class="col-1">

                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION</span>
                                </div>
                                <div class="col-6">
                                    <span *ngIf="administration.adminstrationstatus=='notgiven'">Not given</span>
                                    <span
                                        *ngIf="administration.adminstrationstatus!='notgiven'">{{administration.adminstrationstatus
                                        | titlecase}}</span>
                                </div>
                            </div>
                            <div class="row"
                                *ngIf="administration.adminstrationstatusreason && !currentDose.dose_id.includes('end')">
                                <div class="col-1">

                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">REASON</span>
                                </div>
                                <div class="col-6">
                                    <span
                                        *ngIf="administration.adminstrationstatusreason=='Other'">{{administration.adminstrationstatusreasontext}}</span>
                                    <span
                                        *ngIf="administration.adminstrationstatusreason!='Other'">{{administration.adminstrationstatusreason}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administeredDate}}</span>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">PRODUCT</span>

                                </div>
                                <div class="col-6">
                                    <span>{{productName}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.batchnumber">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                </div>
                                <div class="col-6">
                                    <span>{{administration.batchnumber}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.expirydate">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                </div>
                                <div class="col-6">
                                    <span>{{administration.expirydate | date:'dd-MM-yyyy'}}</span>
                                </div>
                            </div>

                            <div class="row"
                                *ngIf="(administration.administereddescriptivedose || administration.administreddosesize || administration.administeredstrengthneumerator) && !currentDose.dose_id.includes('end')">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">DOSE</span>
                                </div>
                                <div class="col-6">
                                    <span
                                        *ngIf="administration.administreddosesize">{{administration.administreddosesize}}
                                        {{administration.administreddoseunit}}</span>
                                    <span
                                        *ngIf="administration.administeredstrengthneumerator">{{administration.administeredstrengthneumerator}}
                                        {{administration.administeredstrengthneumeratorunits}} /
                                        {{administration.administeredstrengthdenominator}}
                                        {{administration.administeredstrengthdenominatorunits}}</span>
                                    <span
                                        *ngIf="administration.administereddescriptivedose">{{administration.administereddescriptivedose}}</span>
                                </div>
                            </div>
                            <div class="row"
                                *ngIf="administration.administredinfusionrate && !currentDose.dose_id.includes('end')">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">RATE</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administration.administredinfusionrate}}
                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                </div>
                            </div>
                            <div class="row" *ngIf="!currentDose.dose_id.includes('end')">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administration.routename}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="witnessDisplayName">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">WITNESSED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{witnessDisplayName}}</span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.levelofselfadmin">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">CHARTED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{administration.levelofselfadmin}}</span>
                                </div>
                            </div>

                            <div class="row" *ngIf="doctorcomments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">PRESCRIBER's COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <span class="text-break">
                                        {{doctorcomments}}
                                    </span>
                                </div>
                            </div>

                            <div class="row"
                                *ngIf="currentDose.dose_id.includes('end') && infusionEvents.administeredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{infusionEvents.administeredby}}</span>
                                </div>
                            </div>
                            <div class="row border-bottom pb-1"
                                *ngIf="!currentDose.dose_id.includes('end') && administration.administredby">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                </div>
                                <div class="col-6">
                                    <span>{{administration.administredby}}</span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">PLANNED ADMINISTRATION TIME</span>

                                </div>
                                <div class="col-6">
                                    <span>{{plannedDate}}</span>
                                </div>
                            </div>
                            <div class="row"
                                *ngIf="(administration.planneddosesize || administration.plannedstrengthneumerator) && !currentDose.dose_id.includes('end')">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">PLANNED DOSE</span>

                                </div>
                                <div class="col-6">
                                    <span *ngIf="administration.planneddosesize">{{administration.planneddosesize}}
                                        {{administration.planneddoseunit}}</span>
                                    <span
                                        *ngIf="administration.plannedstrengthneumerator">{{administration.plannedstrengthneumerator}}
                                        {{administration.plannedstrengthneumeratorunits}} /
                                        {{administration.plannedstrengthdenominator}}
                                        {{administration.plannedstrengthdenominatorunits}}</span>
                                </div>
                            </div>
                            <div class="row"
                                *ngIf="administration.plannedinfustionrate && !currentDose.dose_id.includes('end')">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">PLANNED RATE</span>

                                </div>
                                <div class="col-6">
                                    <span>{{administration.plannedinfustionrate}}
                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                </div>
                            </div>
                            <div class="row" *ngIf="administration.comments">
                                <div class="col-1">
                                </div>
                                <div class="col-5">
                                    <span class="text-muted empa-label">COMMENTS</span>

                                </div>
                                <div class="col-6">
                                    <div class="emp-comment-block">{{administration.comments}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <a *ngIf="!isShowAdministrationHistory && !isShowHistory" href="#" class="btn-administration-history"
                        (click)="isShowAdministrationHistory = !isShowAdministrationHistory">Show history</a>
                    <a *ngIf="isShowAdministrationHistory !isShowHistory" href="#" class="btn-administration-history"
                        (click)="isShowAdministrationHistory = !isShowAdministrationHistory">Close history</a>
                    <div style="max-height: 62vw;" class="pt-2" *ngIf="isShowAdministrationHistory || isShowHistory">
                        <div style="text-align:center;" *ngIf="appService.MedicationadministrationHistory && appService.DoseEventsHistory && appService.InfusionEventsHistory && appService.MedicationadministrationHistory.length==0 && appService.DoseEventsHistory.length==0 && appService.InfusionEventsHistory.length==0">
                            No Data
                        </div>
                        <div *ngIf="appService.MedicationadministrationHistory && appService.MedicationadministrationHistory.length>0">
                            <div
                                *ngFor="let administration of appService.MedicationadministrationHistory; let i = index">
                                <div
                                    *ngIf="!currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause')">
                                    <div>
                                        <h6
                                            *ngIf="!currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause') && administration._recordstatus==1">
                                            Administration</h6>
                                        <h6
                                            *ngIf="!currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause') && administration._recordstatus==2">
                                            Undo Administration</h6>
                                    </div>
                                    <hr>
                                    <div class="card-body">
                                        <div
                                            *ngIf="!currentDose.dose_id.includes('bolus') && !currentDose.dose_id.includes('addadjust') && !currentDose.dose_id.includes('changeinfusionset') && !currentDose.dose_id.includes('changeinfusionkit') && !currentDose.dose_id.includes('restart') && !currentDose.dose_id.includes('pause')">
                                            <div class="row" *ngIf="!currentDose.dose_id.includes('end')">
                                                <div class="col-1">

                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION</span>
                                                </div>
                                                <div class="col-6">
                                                    <span *ngIf="administration.adminstrationstatus=='notgiven'">Not
                                                        given</span>
                                                    <span
                                                        *ngIf="administration.adminstrationstatus!='notgiven'">{{administration.adminstrationstatus
                                                        | titlecase}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="administration.adminstrationstatusreason && !currentDose.dose_id.includes('end')">
                                                <div class="col-1">

                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">REASON</span>
                                                </div>
                                                <div class="col-6">
                                                    <span
                                                        *ngIf="administration.adminstrationstatusreason=='Other'">{{administration.adminstrationstatusreasontext}}</span>
                                                    <span
                                                        *ngIf="administration.adminstrationstatusreason!='Other'">{{administration.adminstrationstatusreason}}</span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.administrationstartime | date:'dd-MM-yyyy
                                                        HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">PRODUCT</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{setProductHistory(administration.medicationadministration_id,i)}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="administration.batchnumber">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.batchnumber}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="administration.expirydate">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.expirydate | date:'dd-MM-yyyy'}}</span>
                                                </div>
                                            </div>

                                            <div class="row"
                                                *ngIf="(administration.administereddescriptivedose || administration.administreddosesize || administration.administeredstrengthneumerator) && !currentDose.dose_id.includes('end')">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">DOSE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span
                                                        *ngIf="administration.administreddosesize">{{administration.administreddosesize}}
                                                        {{administration.administreddoseunit}}</span>
                                                    <span
                                                        *ngIf="administration.administeredstrengthneumerator">{{administration.administeredstrengthneumerator}}
                                                        {{administration.administeredstrengthneumeratorunits}} /
                                                        {{administration.administeredstrengthdenominator}}
                                                        {{administration.administeredstrengthdenominatorunits}}</span>
                                                    <span
                                                        *ngIf="administration.administereddescriptivedose">{{administration.administereddescriptivedose}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="administration.administredinfusionrate && !currentDose.dose_id.includes('end')">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">RATE</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.administredinfusionrate}}
                                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="!currentDose.dose_id.includes('end')">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.routename}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="administration.levelofselfadmin">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">CHARTED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.levelofselfadmin}}</span>
                                                </div>
                                            </div>
                                            <!--                            
                        <div class="row" *ngIf="currentDose.dose_id.includes('end') && infusionEvents.administeredby">
                            <div class="col-1">                       
                            </div>
                            <div class="col-5">
                                <span class="text-muted empa-label">ADMINISTERED BY</span>                         
                            </div>
                            <div class="col-6">
                                <span>{{infusionEvents.administeredby}}</span>
                            </div>
                        </div> -->
                                            <div class="row"
                                                *ngIf="!currentDose.dose_id.includes('end') && administration.administredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.administredby}}</span>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">PLANNED ADMINISTRATION
                                                        TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.planneddatetime | date:'dd-MM-yyyy
                                                        HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="(administration.planneddosesize || administration.plannedstrengthneumerator) && !currentDose.dose_id.includes('end')">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">PLANNED DOSE</span>

                                                </div>
                                                <div class="col-6">
                                                    <span
                                                        *ngIf="administration.planneddosesize">{{administration.planneddosesize}}
                                                        {{administration.planneddoseunit}}</span>
                                                    <span
                                                        *ngIf="administration.plannedstrengthneumerator">{{administration.plannedstrengthneumerator}}
                                                        {{administration.plannedstrengthneumeratorunits}} /
                                                        {{administration.plannedstrengthdenominator}}
                                                        {{administration.plannedstrengthdenominatorunits}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="administration.plannedinfustionrate && !currentDose.dose_id.includes('end')">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">PLANNED RATE</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{administration.plannedinfustionrate}}
                                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="administration.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <div class="emp-comment-block">{{administration.comments}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>



                        </div>
                        <div *ngIf="appService.DoseEventsHistory && appService.DoseEventsHistory.length>0">
                            <div *ngFor="let doseevent of appService.DoseEventsHistory">
                                <div *ngIf="doseevent.eventtype=='Transfer'">
                                    <div>
                                        <div>
                                            <h6>{{doseevent.eventtype}}</h6>
                                        </div>
                                        <hr>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Transferred From</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.startdatetime | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Transferred To</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.dosedatetime | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Transferred on</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createddate | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Transferred by</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createdby}}
                                                </div>
                                            </div>
                                           
                                        </div>
                                    </div>


                                </div>
                                <div *ngIf="doseevent.eventtype=='Comment'">
                                    <div>
                                        <div>
                                            <h6>{{doseevent.eventtype}}</h6>
                                        </div>
                                        <hr>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Comment</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.comments}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Commented on</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createddate | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Commented by</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createdby}}
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>


                                </div>
                                <div *ngIf="doseevent.eventtype=='Cancel'">
                                    <div>
                                        <div>
                                            <h6 *ngIf="doseevent._recordstatus==2">Undo Cancel</h6>
                                            <h6 *ngIf="doseevent._recordstatus==1">Cancel</h6>
                                        </div>
                                        <hr>
                                        <div class="card-body">
                                            <div class="row" *ngIf="doseevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Comment</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.comments}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label" *ngIf="doseevent._recordstatus==1">Cancelled on</span>
                                                    <span class="text-muted empa-label" *ngIf="doseevent._recordstatus==2">Undo Cancel on</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createddate | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label" *ngIf="doseevent._recordstatus==1">Cancelled by</span>
                                                    <span class="text-muted empa-label" *ngIf="doseevent._recordstatus==2">Undo Cancel by</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createdby}}
                                                </div>
                                            </div>
                                          
                                        </div>
                                    </div>



                                </div>
                                <div *ngIf="doseevent.eventtype=='doconfirm'">
                                    <div>
                                        <div>
                                            <h6>PTC Confirmed</h6>
                                        </div>
                                        <hr>
                                        <div class="card-body">
                                            <div class="row" *ngIf="doseevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Comment</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.comments}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Confirmed on</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createddate | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Confirmed by</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createdby}}
                                                </div>
                                            </div>
                                           
                                        </div>
                                    </div>



                                </div>
                                <div *ngIf="doseevent.eventtype=='titration'">
                                    <div>
                                        <div>
                                            <h6>Titration</h6>
                                        </div>
                                        <hr>
                                        <div class="card-body">
                                            <div class="row" *ngIf="doseevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Comment</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.comments}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Titrated on</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createddate | date: 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Titrated by</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent._createdby}}
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="doseevent.titrateddosesize">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Dose</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.titrateddosesize}}
                                                    {{doseevent.titrateddoseunit}}
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="doseevent.titratedstrengthdenominator">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Dose</span>
                                                </div>
                                                <div class="col-6">
                                                    {{doseevent.titratedstrengthneumerator}}
                                                    {{doseevent.titratedstrengthneumeratorunits}}
                                                    /
                                                    {{doseevent.titratedstrengthdenominator}}
                                                    {{doseevent.titratedstrengthdenominatorunits}}
                                                </div>
                                            </div>                                           
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div *ngIf="appService.InfusionEventsHistory && appService.InfusionEventsHistory.length>0">
                            <div *ngFor="let infusionevent of appService.InfusionEventsHistory; let i = index">
                                <div class="card"
                                    *ngIf="currentDose.dose_id.includes('addadjust') || currentDose.dose_id.includes('pause') || currentDose.dose_id.includes('restart') 
                        || currentDose.dose_id.includes('bolus') || currentDose.dose_id.includes('changeinfusionset') || currentDose.dose_id.includes('changeinfusionkit')">
                                    <div class="card-header">
                                        <h6 *ngIf="currentDose.dose_id.includes('addadjust')">Flowrate Adjusted</h6>
                                        <h6 *ngIf="currentDose.dose_id.includes('pause')">Pause</h6>
                                        <h6 *ngIf="currentDose.dose_id.includes('restart')">Restart</h6>
                                        <h6 *ngIf="currentDose.dose_id.includes('bolus')">Bolus</h6>
                                        <h6
                                            *ngIf="currentDose.dose_id.includes('changeinfusionset') || currentDose.dose_id.includes('changeinfusionkit')">
                                            Change kit/device</h6>
                                    </div>
                                    <div class="card-body">
                                        <div
                                            *ngIf="currentDose.dose_id.includes('addadjust') && getAdministrationHistory(infusionevent.logicalid,i)">
                                            <div class="row"
                                                *ngIf="getAdministrationHistory(infusionevent.logicalid,i).administrationstartime">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administrationstartime
                                                        | date:'dd-MM-yyyy HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="getAdministrationHistory(infusionevent.logicalid,i)">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">RATE</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administredinfusionrate}}
                                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="getAdministrationHistory(infusionevent.logicalid,i).routename">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ROUTE OF ADMINISTRATION</span>

                                                </div>
                                                <div class="col-6">
                                                    <div class="emp-comment-block">
                                                        {{getAdministrationHistory(infusionevent.logicalid,i).routename}}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.batchnumber">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.batchnumber}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.expirydate">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.expirydate | date:'dd-MM-yyyy'}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.administeredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.administeredby}}</span>
                                                </div>
                                            </div>
                                            <div class="row"
                                                *ngIf="getAdministrationHistory(infusionevent.logicalid,i)">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <div class="emp-comment-block">
                                                        {{getAdministrationHistory(infusionevent.logicalid,i).comments}}
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div *ngIf="currentDose.dose_id.includes('pause')">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.eventdatetime | date:'dd-MM-yyyy
                                                        HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.administeredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.administeredby}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.comments}}</span>
                                                </div>
                                            </div>

                                        </div>
                                        <div *ngIf="currentDose.dose_id.includes('restart')">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administrationstartime
                                                        | date:'dd-MM-yyyy HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">RATE</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administredinfusionrate}}
                                                        <span>{{currentposology.infusionrateunits}}</span></span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.batchnumber">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.batchnumber}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.expirydate">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.expirydate | date:'dd-MM-yyyy'}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.administeredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.administeredby}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <div class="emp-comment-block">{{infusionevent.comments}}</div>
                                                </div>
                                            </div>

                                        </div>
                                        <div
                                            *ngIf="currentDose.dose_id.includes('bolus') && getAdministrationHistory(infusionevent.logicalid,i)">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administrationstartime
                                                        | date:'dd-MM-yyyy HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">DOSE</span>

                                                </div>
                                                <div class="col-6" *ngIf="currentposology.dosetype == 'units'">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administreddosesize}}
                                                        mls</span>
                                                </div>
                                                <div class="col-6" *ngIf="currentposology.dosetype == 'strength'">
                                                    <span>{{getAdministrationHistory(infusionevent.logicalid,i).administeredstrengthneumerator}}
                                                        {{getAdministrationHistory(infusionevent.logicalid,i).administeredstrengthneumeratorunits}}</span>
                                                    <span>/
                                                        {{getAdministrationHistory(infusionevent.logicalid,i).administeredstrengthdenominator}}
                                                        {{getAdministrationHistory(infusionevent.logicalid,i).administeredstrengthdenominatorunits}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.batchnumber">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.batchnumber}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.expirydate">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.expirydate | date:'dd-MM-yyyy'}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.administeredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.administeredby}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <div class="emp-comment-block">{{infusionevent.comments}}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            *ngIf="(currentDose.dose_id.includes('changeinfusionset') || currentDose.dose_id.includes('changeinfusionkit'))">
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTRATION TIME</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.eventdatetime | date:'dd-MM-yyyy
                                                        HH:mm'}}</span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">Change Set/Bag </span>

                                                </div>
                                                <div class="col-6">
                                                    <span *ngIf="infusionevent.eventtype=='changeinfusionkit'">Change
                                                        infusion kit</span>
                                                    <span *ngIf="infusionevent.eventtype=='changeinfusionset'">Change
                                                        infusion</span>
                                                </div>
                                            </div>

                                            <div class="row" *ngIf="infusionevent.batchnumber">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">BATCH NUMBER</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.batchnumber}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.expirydate">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">EXPIRY DATE</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.expirydate | date:'dd-MM-yyyy'}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.administeredby">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">ADMINISTERED BY</span>
                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.administeredby}}</span>
                                                </div>
                                            </div>
                                            <div class="row" *ngIf="infusionevent.comments">
                                                <div class="col-1">
                                                </div>
                                                <div class="col-5">
                                                    <span class="text-muted empa-label">COMMENTS</span>

                                                </div>
                                                <div class="col-6">
                                                    <span>{{infusionevent.comments}}</span>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div *ngIf="isWitnessAuthenticate">
    <div class="modal fade bd-example-modal-lg" [config]="{backdrop: 'static',show: true,  keyboard: false}" bsModal
        tabindex="-1" data-keyboard="false" data-backdrop="static" style="display: block;" role="dialog"
        aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <h3 class="popover-title popover-header">
                    Witness authentication
                    <div class="close close-adminstration" (click)="closeWitnessAuthentication()"></div>
                </h3>
                <div class="modal-body">
                    <div class="row">

                        <div class="col-3 text-right">
                            <span class="text-muted empa-label">Username</span>

                        </div>
                        <div class="col-8">
                            <input type="text" (keydown.enter)="authenticateUser()" class="form-control" name="username"
                                [(ngModel)]="username">
                        </div>
                    </div>

                    <div class="row mt-1">

                        <div class="col-3 text-right">
                            <span class="text-muted empa-label">Password</span>

                        </div>
                        <div class="col-8">
                            <input type="password" (keydown.enter)="authenticateUser()" name="password"
                                class="form-control" [(ngModel)]="password">

                            <span *ngIf="authMessage" class="text-danger">{{authMessage}}</span>
                        </div>

                    </div>

                    <div class="row mt-1">

                        <div class="col-3">

                        </div>
                        <div class="col-8">
                            <button class="btn btn-primary" (click)="authenticateUser()"
                                [disabled]="showSpinnerWitness"> <span class="spinner-border spinner-border-sm"
                                    *ngIf="showSpinnerWitness" role="status" aria-hidden="true"></span>Save</button>
                            <button class="btn btn-secondary ml-3"
                                (click)="closeWitnessAuthentication()">Cancel</button>

                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div *ngIf="isAdministrationWarning">
    <div class="modal fade bd-example-modal-lg" [config]="{backdrop: 'static',show: true,  keyboard: false}" bsModal
        tabindex="-1" data-keyboard="false" data-backdrop="static" style="display: block;" role="dialog"
        aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <h3 class="popover-title popover-header">
                    Warnings
                    <div class="close close-adminstration" (click)="isAdministrationWarning=false"></div>
                </h3>
                <div class="modal-body">
                    <div [appWarningsLoader]="componentModuleData"></div>
                </div>

            </div>
        </div>
    </div>
</div>
<ng-template #confirmWardStockTemplate>
    <div class="modal-body">
        <h5>
            This drug is resupplied from ward stock. Are you sure to make a request to the pharmacy?
        </h5>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="confirmWardStock()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="declineWardStock()">No</button>
    </div>
</ng-template>



<div class="modal fade bd-example-modal-md" [config]="{backdrop: 'static',show: true,  keyboard: false}" bsModal
    role="dialog" style="display: block;" *ngIf="displayStyle">
    <div class="modal-dialog modal-md modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title">Undo administration - Error</h6>
            </div>
            <div class="modal-body">
                <p>This action causes two administration event to occur at the same time - please address the conflicting administration event that is currently at {{undoConflictTime | date : 'dd-MM-yyyy HH:mm'}} before attempting this
                </p>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" (click)="undoAdministrationOk()">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>